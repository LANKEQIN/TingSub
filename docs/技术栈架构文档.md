# 汀阅（TingSub）技术栈架构文档

## 一、技术栈整体架构

### 1.1 架构概述
汀阅（TingSub）采用Expo React Native作为核心框架，构建跨平台移动应用。整体架构采用分层设计，分为UI层、业务逻辑层、数据层和基础设施层，确保代码的可维护性和可扩展性。

### 1.2 架构原则
1. **跨平台优先**：优先选择支持iOS和Android的跨平台技术
2. **轻量级**：选择轻量级的库和工具，减少应用体积
3. **可维护性**：代码结构清晰，易于理解和维护
4. **性能优化**：注重应用性能，提供流畅的用户体验
5. **安全性**：保护用户数据安全，遵循隐私保护法规

### 1.3 项目目录结构
```
TingSub/
├── .expo/                    # Expo配置文件
├── .expo-shared/             # Expo共享配置
├── .git/                     # Git版本控制
├── .github/                  # GitHub Actions工作流
│   └── workflows/            # CI/CD配置
├── .trae/                    # Trae IDE配置
│   └── rules/                # 项目规则
├── android/                  # Android原生代码
│   ├── app/                  # Android应用代码
│   ├── gradle/               # Gradle构建配置
│   └── build.gradle          # Gradle构建文件
├── ios/                      # iOS原生代码
│   ├── TingSub/              # iOS应用代码
│   └── Podfile               # CocoaPods依赖管理
├── assets/                   # 静态资源
│   ├── images/               # 图片资源
│   ├── fonts/                # 字体文件
│   └── icons/                # 图标资源
├── docs/                     # 项目文档
│   ├── 产品需求文档.md
│   ├── 技术栈架构文档.md
│   └── 数据结构设计文档.md
├── src/                      # 源代码目录
│   ├── components/           # 可复用组件
│   │   ├── common/           # 通用组件
│   │   ├── subscription/     # 订阅相关组件
│   │   ├── category/         # 分类相关组件
│   │   ├── statistics/       # 统计相关组件
│   │   └── settings/         # 设置相关组件
│   ├── screens/              # 页面组件
│   │   ├── HomeScreen.tsx    # 首页
│   │   ├── SubscriptionListScreen.tsx  # 订阅列表页
│   │   ├── SubscriptionDetailScreen.tsx # 订阅详情页
│   │   ├── AddSubscriptionScreen.tsx   # 添加订阅页
│   │   ├── CategoryListScreen.tsx      # 分类列表页
│   │   ├── StatisticsScreen.tsx        # 统计页
│   │   └── SettingsScreen.tsx          # 设置页

│   ├── navigation/           # 导航配置
│   │   ├── AppNavigator.tsx # 应用导航器
│   │   ├── TabNavigator.tsx # 标签导航器
│   │   └── types.ts         # 导航类型定义
│   ├── store/                # 状态管理
│   │   ├── useStore.ts       # Zustand store
│   │   ├── subscriptionStore.ts  # 订阅状态
│   │   ├── categoryStore.ts      # 分类状态
│   │   └── userStore.ts          # 用户状态
│   ├── services/             # 业务服务层
│   │   ├── api/              # API服务（后续版本）
│   │   ├── notification/     # 通知服务
│   │   └── export/           # 数据导出服务
│   ├── repositories/         # 数据访问层
│   │   ├── UserRepository.ts
│   │   ├── SubscriptionRepository.ts
│   │   ├── CategoryRepository.ts
│   │   └── TagRepository.ts
│   ├── models/               # 数据模型
│   │   ├── User.ts
│   │   ├── Subscription.ts
│   │   ├── Category.ts
│   │   └── Tag.ts
│   ├── utils/                # 工具函数
│   │   ├── dateUtils.ts      # 日期处理
│   │   ├── validationUtils.ts # 数据验证
│   │   ├── formatUtils.ts    # 格式化工具
│   │   └── encryptionUtils.ts # 加密工具
│   ├── constants/            # 常量定义
│   │   ├── appConstants.ts   # 应用常量
│   │   ├── storageKeys.ts    # 存储键名
│   │   └── theme.ts          # 主题配置
│   ├── hooks/                # 自定义Hooks
│   │   ├── useSubscriptions.ts
│   │   ├── useCategories.ts
│   │   └── useNotifications.ts
│   ├── types/                # TypeScript类型定义
│   │   ├── index.ts          # 统一导出
│   │   ├── user.ts
│   │   ├── subscription.ts
│   │   └── category.ts
│   └── config/               # 配置文件
│       ├── env.ts            # 环境配置
│       └── realm.ts          # Realm数据库配置
├── __tests__/                # 测试文件
│   ├── components/           # 组件测试
│   ├── screens/              # 页面测试
│   └── utils/                # 工具函数测试
├── .eslintrc.js              # ESLint配置
├── .prettierrc               # Prettier配置
├── .gitignore                # Git忽略文件
├── app.json                  # Expo应用配置
├── babel.config.js           # Babel配置
├── package.json              # 项目依赖
├── tsconfig.json             # TypeScript配置
├── README.md                 # 项目说明
└── yarn.lock                 # Yarn依赖锁定文件
```

### 1.4 目录结构说明
- **components/**：存放可复用的UI组件，按功能模块分类
- **screens/**：存放页面级组件，每个页面一个文件
- **navigation/**：存放导航相关配置和类型定义
- **store/**：存放Zustand状态管理相关代码
- **services/**：存放业务逻辑服务，如API调用、通知服务等
- **repositories/**：存放数据访问层，封装数据库操作
- **models/**：存放数据模型定义
- **utils/**：存放工具函数，如日期处理、数据验证等
- **constants/**：存放应用常量，如主题、存储键名等
- **hooks/**：存放自定义React Hooks
- **types/**：存放TypeScript类型定义
- **config/**：存放配置文件，如环境配置、数据库配置等

## 二、前端技术栈

### 2.1 核心框架
#### 2.1.1 Expo React Native
- **版本**：最新稳定版
- **用途**：构建跨平台移动应用的核心框架
- **优势**：
  - 跨平台开发，一套代码同时支持iOS和Android
  - 丰富的内置API，减少原生代码开发
  - 热重载功能，提升开发效率
  - 完善的文档和社区支持

### 2.2 UI组件库
#### 2.2.1 React Native Paper
- **版本**：最新稳定版
- **用途**：UI组件库，提供Material Design风格的组件
- **优势**：
  - 遵循Material Design规范，界面美观统一
  - 提供丰富的组件，满足大部分UI需求
  - 支持主题定制，实现深色/浅色模式
  - 良好的文档和社区支持

#### 2.2.2 React Native Vector Icons
- **版本**：最新稳定版
- **用途**：提供丰富的图标库
- **优势**：
  - 支持多种图标库（Material Icons、Font Awesome等）
  - 矢量图标，支持缩放不失真
  - 易于集成和使用

### 2.3 状态管理
#### 2.3.1 Zustand
- **版本**：最新稳定版
- **用途**：轻量级状态管理库
- **优势**：
  - 极简API，易于上手
  - 无需Provider组件，减少嵌套
  - 支持中间件，扩展功能
  - 良好的性能表现

### 2.4 导航路由
#### 2.4.1 React Navigation
- **版本**：6.x
- **用途**：应用导航路由管理
- **优势**：
  - 支持多种导航模式（栈导航、标签导航、抽屉导航）
  - 自定义导航栏，满足个性化需求
  - 路由参数传递，实现页面间数据通信
  - 完善的文档和社区支持

### 2.5 本地存储
#### 2.5.1 AsyncStorage
- **版本**：@react-native-async-storage/async-storage
- **用途**：简单键值对存储，用于存储用户配置、偏好设置等
- **优势**：
  - 异步操作，不阻塞主线程
  - 简单易用的API
  - 支持iOS和Android平台

#### 2.5.2 Realm
- **版本**：最新稳定版
- **用途**：本地数据库，用于存储结构化数据（如订阅信息）
- **优势**：
  - 高性能的NoSQL数据库
  - 支持复杂查询和事务
  - 数据加密，保护用户隐私
  - 跨平台支持

### 2.6 表单处理
#### 2.6.1 Formik
- **版本**：最新稳定版
- **用途**：表单状态管理和验证
- **优势**：
  - 简化表单处理逻辑
  - 支持表单验证
  - 与React Native Paper组件良好集成

#### 2.6.2 Yup
- **版本**：最新稳定版
- **用途**：表单验证库
- **优势**：
  - 声明式验证规则
  - 支持复杂验证逻辑
  - 与Formik无缝集成

### 2.7 日期处理
#### 2.7.1 date-fns
- **版本**：最新稳定版
- **用途**：日期格式化、计算和解析
- **优势**：
  - 模块化设计，按需导入
  - 支持多语言
  - 轻量级，体积小

### 2.8 图表可视化
#### 2.8.1 React Native Chart Kit
- **版本**：最新稳定版
- **用途**：数据可视化，展示统计图表
- **优势**：
  - 支持多种图表类型（折线图、柱状图、饼图等）
  - 自定义样式，满足设计需求
  - 易于集成和使用

## 三、后端与云端服务

### 3.1 架构说明
当前版本（V1.0.0）暂不考虑云端服务，所有数据存储在本地设备上。后续版本（V2.0.0）将引入云端服务，实现数据同步和备份。

### 3.2 未来云端架构规划
#### 3.2.1 后端框架
- **Node.js + Express**：轻量级后端框架
- **TypeScript**：类型安全的JavaScript超集

#### 3.2.2 数据库
- **MongoDB**：NoSQL数据库，存储用户数据和订阅信息
- **Redis**：缓存数据库，提升系统性能

#### 3.2.3 认证授权
- **JWT**：JSON Web Token，实现用户认证
- **OAuth2.0**：第三方登录授权

#### 3.2.4 云服务提供商
- **AWS**：亚马逊云服务，提供计算、存储、数据库等服务
- **Firebase**：谷歌云服务，提供认证、数据库、存储等服务

## 四、第三方服务集成

### 4.1 推送通知
#### 4.1.1 Expo Notifications
- **用途**：本地推送通知，实现订阅到期提醒
- **优势**：
  - 跨平台支持，一套代码同时支持iOS和Android
  - 简单易用的API
  - 与Expo框架深度集成

### 4.2 数据导出
#### 4.2.1 react-native-csv
- **用途**：将订阅数据导出为CSV格式
- **优势**：
  - 简单易用的API
  - 支持自定义导出字段
  - 轻量级，体积小

### 4.3 设备信息
#### 4.3.1 Expo Device
- **用途**：获取设备信息，如设备型号、操作系统版本等
- **优势**：
  - 跨平台支持
  - 简单易用的API
  - 与Expo框架深度集成

## 五、环境配置

### 5.1 开发环境配置

#### 5.1.1 环境变量配置
```typescript
// src/config/env.ts
export const ENV = {
  // 应用环境
  NODE_ENV: process.env.NODE_ENV || 'development',
  
  // 应用配置
  APP_NAME: '汀阅',
  APP_VERSION: '1.0.0',
  
  // API配置（后续版本）
  API_BASE_URL: process.env.API_BASE_URL || 'https://api.tingsub.com',
  API_TIMEOUT: 10000,
  
  // 数据库配置
  REALM_ENCRYPTION_KEY: process.env.REALM_ENCRYPTION_KEY || '',
  REALM_SCHEMA_VERSION: 1,
  
  // 功能开关
  ENABLE_CLOUD_SYNC: process.env.ENABLE_CLOUD_SYNC === 'true',
  ENABLE_ANALYTICS: process.env.ENABLE_ANALYTICS === 'true',
  ENABLE_CRASH_REPORTING: process.env.ENABLE_CRASH_REPORTING === 'true',
  
  // 调试配置
  DEBUG_MODE: process.env.NODE_ENV === 'development',
  LOG_LEVEL: process.env.LOG_LEVEL || 'info',
};

// 环境判断
export const isDevelopment = ENV.NODE_ENV === 'development';
export const isProduction = ENV.NODE_ENV === 'production';
export const isTest = ENV.NODE_ENV === 'test';
```

#### 5.1.2 .env文件配置
```bash
# .env.development
NODE_ENV=development
API_BASE_URL=http://localhost:3000
ENABLE_CLOUD_SYNC=false
ENABLE_ANALYTICS=false
ENABLE_CRASH_REPORTING=false
LOG_LEVEL=debug

# .env.production
NODE_ENV=production
API_BASE_URL=https://api.tingsub.com
ENABLE_CLOUD_SYNC=true
ENABLE_ANALYTICS=true
ENABLE_CRASH_REPORTING=true
LOG_LEVEL=error
```

#### 5.1.3 开发环境要求
- **Node.js**：16.x LTS版本或更高
- **npm**：7.x或更高版本
- **yarn**：1.22.x或或更高版本（推荐）
- **Expo CLI**：最新稳定版
- **React Native CLI**：最新稳定版
- **JDK**：11或更高版本（Android开发）
- **Android Studio**：最新稳定版（Android开发）
- **Xcode**：13.0或更高版本（iOS开发，仅macOS）
- **CocoaPods**：最新稳定版（iOS开发）

#### 5.1.411 开发环境安装步骤
```bash
# 1. 克隆项目
git clone https://github.com/yourusername/TingSub.git
cd TingSub

# 2. 安装依赖
yarn install

# 3. 安装Expo CLI
yarn global add expo-cli

# 4. 启动开发服务器
yarn start

# 5. 在模拟器或真机上运行
# iOS
yarn ios

# Android
yarn android
```

### 5.2 生产环境配置

#### 5.2.1 生产环境构建配置
```json
// app.json
{
  "expo": {
    "name": "汀阅",
    "slug": "tingsub",
    "version": "1.0.0",
    "orientation": "portrait",
    "icon": "./assets/icon.png",
    "splash": {
      "image": "./assets/splash.png",
      "resizeMode": "contain",
      "backgroundColor": "#ffffff"
    },
    "updates": {
      "fallbackToCacheTimeout": 0
    },
    "assetBundlePatterns": [
      "**/*"
    ],
    "ios": {
      "supportsTablet": true,
      "bundleIdentifier": "com.tingsub.app",
      "buildNumber": "1"
    },
    "android": {
      "adaptiveIcon": {
        "foregroundImage": "./assets/adaptive-icon.png",
        "backgroundColor": "#FFFFFF"
      },
      "package": "com.tingsub.app",
      "versionCode": 1
    },
    "extra": {
      "eas": {
        "projectId": "your-project-id"
      }
    }
  }
}
```

#### 5.2.2 EAS Build配置
```json
// eas.json
{
  "cli": {
    "version": ">= 5.2.0"
  },
  "build": {
    "development": {
      "developmentClient": true,
      "distribution": "internal"
    },
    "preview": {
      "distribution": "internal",
      "android": {
        "buildType": "apk"
      }
    },
    "production": {
      "ios": {
        "autoIncrement": true
      },
      "android": {
        "buildType": "app-bundle"
      }
    }
  }
}
```

#### 5.2.3 生产环境构建步骤
```bash
# 1. 登录Expo账户
expo login

# 2. 配置EAS Build
eas build:configure

# 3. 构建iOS应用
eas build --platform ios --profile production

# 4. 构建Android应用
eas build --platform android --profile production

# 5. 提交到应用商店
# iOS
eas submit --platform ios

# Android
eas submit --platform android
```

#### 5.2.4 生产环境优化
- **代码压缩**：启用Terser压缩JavaScript代码
- **资源优化**：压缩图片资源，使用WebP格式
- **包体积优化**：使用Tree Shaking移除未使用的代码
- **性能优化**：启用Hermes引擎提升性能
- **安全加固**：代码混淆、资源加密

### 5.3 环境切换
```typescript
// 根据环境加载不同配置
const loadConfig = () => {
  if (isDevelopment) {
    return require('./config/development');
  } else if (isProduction) {
    return require('./config/production');
  } else {
    return require('./config/test');
  }
};

export const config = loadConfig();
```

## 六、开发工具链

### 6.1 开发环境
- **Node.js**：16.x LTS版本
- **npm/yarn**：包管理器
- **Expo CLI**：Expo开发工具
- **Visual Studio Code**：代码编辑器

### 6.2 代码质量
#### 6.2.1 ESLint
- **用途**：代码质量检查，遵循代码规范
- **配置**：使用Airbnb JavaScript Style Guide

#### 6.2.2 Prettier
- **用途**：代码格式化，保持代码风格统一
- **配置**：与ESLint集成，自动格式化代码



#### 6.2.3 TypeScript
- **用途**：类型检查，提升代码质量
- **配置**：严格模式，确保类型安全

### 6.3 测试工具
#### 6.3.1 Jest
- **用途**：单元测试和集成测试
- **优势**：
  - 简单易用的API
  - 与React Native良好集成
  - 支持快照测试

#### 6.3.2 React Native Testing Library
- **用途**：React Native组件测试
- **优势**：
  - 以用户行为为中心的测试方式
  - 与Jest良好集成
  - 支持异步测试

## 七、构建与部署

### 7.1 构建工具
- **Expo Build**：构建iOS和Android应用包
- **EAS Build**：Expo Application Services，提供云端构建服务

### 7.2 部署渠道
#### 7.2.1 iOS
- **App Store**：官方应用商店
- **TestFlight**：Beta测试平台

#### 7.2.2 Android
- **Google Play Store**：官方应用商店
- **华为应用市场**：华为设备应用商店
- **小米应用商店**：小米设备应用商店

### 7.3 版本管理
- **Git**：代码版本控制
- **GitHub/GitLab**：代码托管平台
- **Semantic Versioning**：语义化版本管理

## 八、性能优化

### 8.1 代码优化
- **按需加载**：使用React.lazy和Suspense实现组件按需加载
- **Memoization**：使用React.memo、useMemo和useCallback减少不必要的重渲染
- **图片优化**：使用Expo Image组件，支持图片缓存和懒加载

### 8.2 内存优化
- **及时清理**：在组件卸载时清理定时器、事件监听器等
- **避免内存泄漏**：使用useEffect的清理函数
- **优化列表渲染**：使用FlatList组件，支持虚拟列表

### 8.3 网络优化
- **缓存策略**：对网络请求结果进行缓存
- **请求合并**：合并多个相似的网络请求
- **离线支持**：提供离线模式，缓存必要的数据

## 九、安全性

### 9.1 数据加密
- ****本地存储加密**：使用Realm的加密功能，加密本地数据库
- **敏感数据保护**：对用户敏感数据（如密码、支付信息）进行加密存储

### 9.2 权限管理
- **最小权限原则**：仅申请必要的系统权限
- **权限说明**：在申请权限时向用户说明用途
- **动态权限申请**：在需要时才申请权限，而不是在应用启动时一次性申请所有权限

### 9.3 隐私保护
- **数据最小化**：仅收集必要的用户数据
- **用户控制**：允许用户查看、修改和删除自己的数据
- **合规性**：遵循GDPR、CCPA等隐私保护法规

## 十、附录

### 10.1 技术栈版本清单
| 技术栈 | 版本 | 用途 |
| --- | --- | --- |
| Expo React Native | 最新稳定版 | 核心框架 |
| React Native Paper | 最新稳定版 | UI组件库 |
| React Native Vector Icons | 最新稳定版 | 图标库 |
| Zustand | 最新稳定版 | 状态管理 |
| React Navigation | 6.x | 导航路由 |
| AsyncStorage | 最新稳定版 | 简单键值对存储 |
| Realm | 最新稳定版 | 本地数据库 |
| Formik | 最新稳定版 | 表单处理 |
| Yup | 最新稳定版 | 表单验证 |
| date-fns | 最新稳定版 | 日期处理 |
| React Native Chart Kit | 最新稳定版 | 图表可视化 |
| Expo Notifications | 最新稳定版 | 推送通知 |
| react-native-csv | 最新稳定版 | 数据导出 |

### 9.2 参考资料
- 《Expo React Native 官方文档》
- 《React Native Paper 官方文档》
- 《Zustand 官方文档》
- 《React Navigation 官方文档》